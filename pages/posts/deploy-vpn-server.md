---
title: æ­å»ºvpnæœåŠ¡å™¨
date: 2023-07-27
duration: 10min
category:
  - Docker
  - Linux
---

### VPN åŸç†

`VPN`å…¶å®åŸç†å°±æ˜¯é€šè¿‡ä¸€äº›åè®®ï¼Œä¾‹å¦‚**PPTP**ã€**L2TP**ç­‰åè®®å»ºç«‹ä¸¤ä¸ªç»ˆç«¯çš„é€šé“ï¼Œä½¿å¾—ä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´å¯ä»¥ç›¸äº’è¿›è¡Œæ“ä½œçš„è¡Œä¸ºã€‚é‚£ä¹ˆæˆ‘ä»¬å¹³æ—¶çš„`æ¢¯å­`ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰‹æœºæˆ–è€…ç”µè„‘é€šè¿‡ VPN è¿æ¥å›½å¤–çš„æœåŠ¡å™¨ï¼Œå› ä¸ºå›½å¤–çš„æœåŠ¡å™¨å¯ä»¥æ­£å¸¸è®¿é—®å›½å¤–çš„ç½‘ç«™ã€‚æ‰€ä»¥ä¸€æ—¦è¿æ¥æˆåŠŸçš„è¯ï¼Œæˆ‘ä»¬çš„è¿æ¥è®¾å¤‡ä¹Ÿå°±æ‹¥æœ‰äº†è®¿é—®å›½å¤–ç½‘ç«™çš„èƒ½åŠ›å•¦ï½ï½ï½

### Software ä»£ç†è½¯ä»¶

æœ‰äº† vpn æœåŠ¡ï¼Œæˆ‘ä»¬è¿˜éœ€ç»™æˆ‘ä»¬çš„è®¾å¤‡å®‰è£…ä»£ç†è½¯ä»¶ï¼Œå°½ç®¡æˆ‘ä»¬æ‰‹æœºæˆ–è€…ç”µè„‘è‡ªå¸¦ vpn çš„ä»£ç†é…ç½®ï¼Œä½†æœ‰äº›é«˜çº§ VPN é…ç½®æ˜¯ç³»ç»Ÿä¸æ”¯æŒçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¾—ä¸‹è½½ä¸€äº›ä»£ç†è½¯ä»¶æ¥è¿æ¥æˆ‘ä»¬çš„ VPN æœåŠ¡ã€‚å¸‚é¢ä¸Šæœ‰å¼€æºå…è´¹çš„`Clash`ï¼Œæ²¡é”™å°±æ˜¯é‚£åªçŒ« ğŸ˜‚

![](/images/b3f7cebd-372c-4553-b90a-753a3df98f39.webp)

ä½†ä»–åªæä¾›ç”µè„‘ç«¯ã€‚æ‰‹æœºç«¯ç”¨çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯`Shadowrocket`ï¼Œä½†åªæœ‰éå¤§é™†çš„è‹¹æœè´¦å·æ‰èƒ½ä¸‹è½½ã€‚é‚£ä¹ˆä»¥ä¸‹åˆ†äº«ä¼šä»¥ Clash ä¸ºä¾‹å­æ•™å¤§å®¶å¦‚ä½•æ­å»º VPN æœåŠ¡å™¨ã€‚

### è®¢é˜…åœ°å€

ä¸€èˆ¬ä»£ç†å•†éƒ½ä¼šæä¾›ï¼Œä¸‹è½½ä¹‹åå°±ä¼šå¾—åˆ°å„ä¸ªèŠ‚ç‚¹çš„é…ç½®ä¿¡æ¯ï¼Œè¿™é‡Œå°±ä¸åšæ¨å¹¿äº†ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªå·±ç™¾åº¦äº†è§£ä¸€ä¸‹ã€‚

### Clash

é¦–å…ˆ clash å¾ˆå¤šå®¢æˆ·ç«¯ï¼Œå…¶ä¸­ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯ä¸€ä¸ªä»“åº“åä¸º`clash_for_windows_pkg`çš„å¼€æºåº“ï¼Œé‡Œé¢å‘å¸ƒäº†å¾ˆå¤šç‰ˆæœ¬çš„ GUI ç•Œé¢ã€‚

![](/images/7c251092-53c5-4c10-812a-cbf72e16e0a3.webp)

ä½†æˆ‘ä»¬æ—¢ç„¶è¦æ­å»º VPN çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå¿…ç„¶å°±è¦é¦–å…ˆ pass æ‰è¿™ç§ GUI çš„ç•Œé¢ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ç”¨å‘½ä»¤è¡Œå»æ‰§è¡Œ VPN çš„ä»£ç†ã€‚æ‰€ä»¥æˆ‘è¦éœ€è¦ç”¨åˆ°ä»–ä»¬çš„å®˜æ–¹åº“ï¼Œä»“åº“åœ°å€ä¸ºï¼š`https://github.com/Dreamacro/clash`ï¼Œç‚¹å‡» releases ä¸­æŸ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æœ‰å¾ˆå¤šæ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬ã€‚ä¸€èˆ¬æœåŠ¡å™¨éƒ½æ˜¯ centos çš„ x86 æ¶æ„ï¼Œæˆ‘ä»¬ç›´æ¥é€‰æ‹©`linux-386`ä¸‹è½½å³å¯ã€‚

![](/images/6723df89-8b3f-479f-96c0-127f3c543adb.webp)

1. ä¸‹è½½å®Œè§£å‹ä¼šå‘ç°é‡Œé¢å°±æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦åœ¨ç»ˆç«¯èµ‹äºˆæˆ‘ä»¬æ‰§è¡Œçš„æƒé™

```bash
chmod -R 777 ./clash-linux-386-v1.17.0
```

2. ä¸‹è½½è®¢é˜…åœ°å€å¯¹åº”çš„é…ç½®æ–‡ä»¶
   æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨å‘½ä»¤è¡Œä¸‹è½½

```bash
wget "è®¢é˜…é“¾æ¥" -O subscription.yaml
```

ä¹Ÿå¯ä»¥ç›´æ¥ä» GUI ä¸Šå³é”®æ‰“å¼€é…ç½®æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·å–

![](/images/8feb6d43-630b-45a9-992a-2c4df929f828.webp)

3. ç„¶åå°±æ˜¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ç›´æ¥å¯åŠ¨ vpn å•¦

```bash
./clash -f subscription.yaml ## ./clash -d .
```

- `-f`: æŒ‡å®šé…ç½®æ–‡ä»¶
- `-d`: æŒ‡å®šé…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•

### webui

å®˜ç½‘ä½œè€…(go è¯­è¨€å¤§ä½¬)è€ƒè™‘åˆ°å‘½ä»¤è¡Œç»ˆç«¯æ“ä½œçš„ä¾¿æ·æ€§ï¼Œæ‹‰äº†å‰ç«¯å¤§ä½¬å†™äº†ä¸€ä¸ª react å‰ç«¯é¡¹ç›®ã€‚ä»“åº“åœ¨`https://github.com/Dreamacro/clash-dashboard`ã€‚æˆ‘ä»¬å¦‚æœæƒ³å¯¹æœåŠ¡å™¨ä¸Šçš„ vpn ä»£ç†èŠ‚ç‚¹è¿›è¡Œä¾¿æ·åˆ‡æ¢çš„è¯ï¼Œè¿™ä¸ªè¿˜æ˜¯éå¸¸æœ‰å¿…è¦å®‰è£…çš„ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹ã€‚

```bash
git clone https://github.com/Dreamacro/clash-dashboard.git && pnpm i && pnpm build
```

æ‰§è¡Œå®Œä¹‹åä¼šçœ‹åˆ°ä¸€ä¸ª dist ç›®å½•ï¼Œè¿™å°±æ˜¯æ„å»ºä¹‹åçš„äº§ç‰©ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸Šé¢è®¢é˜…é…ç½®æ–‡ä»¶åŠ å…¥ä¸‰è¡Œé…ç½®å³å¯å¯åŠ¨ weiui ç•Œé¢ã€‚

```yaml
external-controller: 0.0.0.0:9090
external-ui: /app/clash-dashboard/dist
secret: 123
```

- `external-controller`: webui æœåŠ¡å¯åŠ¨åœ¨å“ªä¸ªç«¯å£
- `external-ui`: æ„å»ºäº§ç‰©ä½ç½®åœ¨å“ª
- `secret`: è®¿é—® webui çš„å¯†é’¥
  é…ç½®å®Œä¹‹åï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šé¢é…ç½®çš„`external-controller`åœ°å€ã€‚

å°±æ˜¯å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç•Œé¢å•¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢ç›´æ¥åˆ‡æ¢ vpn ä»£ç†èŠ‚ç‚¹ã€‚

![](/images/564b99bc-679b-4d57-884e-1c9a92c92de6.webp)

### Docker éƒ¨ç½²

clash ä¹Ÿæ˜¯æ”¯æŒ**docker éƒ¨ç½²**çš„ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ª docker-compose.yaml çš„é…ç½®æ–‡ä»¶ï¼Œä»…ä¾›å‚è€ƒ...

```yaml
version: '3'
services:
  clash:
    image: ghcr.io/dreamacro/clash
    restart: always
    # é»˜è®¤7890ä»£ç†ç«¯å£
    ports:
      - 7890:7890
    # æŒ‚åœ¨vpnä»£ç†é…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬ä»£ç†å•†éƒ½ä¼šç»™ä½ è®¢é˜…åœ°å€ï¼Œç›´æ¥ä¸‹è½½å³å¯
    volumes:
      - $HOME/.config/clash:/root/.config/clash/
```

**`clash å¯åŠ¨`**

```bash
docker-compose up -d
```

### ç³»ç»ŸæœåŠ¡

clash ä¹Ÿæ”¯æŒåœ¨ linux ä¸­ä»¥ç³»ç»ŸæœåŠ¡çš„æ–¹å¼è¿›è¡Œæ§åˆ¶ç®¡ç†ã€‚ä»¥ä¸‹ä¸ºä¸€ä¸ªç³»ç»ŸæœåŠ¡çš„é…ç½®æ–‡ä»¶ã€‚

```bash
[Unit]
Description=Clash daemon, A rule-based proxy in Go.
After=network-online.target

[Service]
Type=simple
Restart=always
ExecStart=/usr/local/bin/clash -d /etc/clash

[Install]
WantedBy=multi-user.target
```

> è¯·æ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨`/etc/systemd/system`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºæ‰ç”Ÿæ•ˆï¼Œä»¥åŠç¡®ä¿ä¸Šé¢çš„ ExecStart æ‰§è¡Œå‘½ä»¤çš„è·¯å¾„æ˜¯å¦å’Œä½ çš„ä¸€è‡´ã€‚

ç„¶åæ‰§è¡Œä¸€ä¸‹å‘½ä»¤

```bash
## å¼€å§‹å®ˆæŠ¤è¿›ç¨‹
systemctl daemon-reload
## æ³¨å†ŒclashæœåŠ¡
systemctl enable clash
## å¼€å¯clashæœåŠ¡
systemctl start clash
```
